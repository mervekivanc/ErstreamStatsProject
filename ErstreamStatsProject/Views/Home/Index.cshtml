@{
    ViewBag.Title = "Real Time";
}

@section head{
    <link href="~/Content/metronic_v4.7.5/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/metronic_v4.7.5/assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/metronic_v4.7.5/assets/global/css/plugins.css" rel="stylesheet" />

}
<div class="page-content-wrapper">
    <!-- BEGIN CONTENT BODY -->
    <div class="page-content no-padding-top" id="index-content">
        <div class="row">
            <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12 padding-right-5">
                <div class="dashboard-stat2 bordered col-lg-12 col-md-4 col-sm-4 col-xs-12">
                    <div class="display padding-top-15">
                        <div class="number">
                            <h3 class="font-green-sharp">
                                <span id="UserValue" data-counter="counterup" data-value="0">0</span>
                                @*<small class="font-green-sharp">$</small>*@
                            </h3>
                            <small>CONCURRENT USER</small>
                        </div>
                        <div class="icon">
                            <i class="icon-bar-chart"></i>
                        </div>
                    </div>
                </div>
                <div class="dashboard-stat2 bordered col-lg-12 col-md-4 col-sm-4 col-xs-12">
                    <div class="display padding-top-15">
                        <div class="number">
                            <h3 class="font-red-haze">
                                <span id="TrafficValue" data-counter="counterup" data-value="0"> 0</span>
                                <small class="font-red-haze" id="bitType">Gbps</small>
                            </h3>
                            <small>TRAFFIC</small>
                        </div>
                        <div class="icon">
                            <i class="icon-pie-chart"></i>
                        </div>
                    </div>
                </div>
                <div class="dashboard-stat2 bordered col-lg-12 col-md-4 col-sm-4 col-xs-12 border-0">
                    <div class="display padding-top-15">
                        <div class="number">
                            <h3 class="font-purple-soft">
                                <span id="TotalSentBytesInTB" data-counter="counterup" data-value="0">0</span>
                                <small class="font-purple-soft">TB</small>
                            </h3>
                            <small>TOTAL CONSUMPTION</small>
                        </div>
                        <div class="icon">
                            <i class="icon-graph"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-xs-12 col-sm-12 col-xs-12">
                <div class="portlet light bordered border-0" id="index-content-portlet">
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase font-dark">CONCURENT USER</span>
                            <span class="caption-helper">distance stats...</span>
                        </div>
                        <div class="actions">
                            <span class="time-information">
                                last 30 min
                            </span>
                            <a class="btn btn-circle btn-icon-only btn-default fullscreen" href="#"> </a>
                            <a class="btn btn-circle btn-icon-only btn-default" href="">
                                <i class="icon-cloud-download"></i>
                            </a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="con-user" style="min-width:inherit; height: 350px; margin: 0 auto"></div>

                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4 col-md-12 col-xs-12 col-sm-12 padding-right-5">
                <!-- BEGIN PORTLET-->
                <div class="portlet light bordered padding-bottom-25 border-0">
                    <div class="portlet-title tabbable-line">
                        <div class="caption">
                            <i class="icon-globe font-dark hide"></i>
                            <span class="caption-subject font-dark bold uppercase">Top 20 Series</span>
                        </div>
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#tab_1_1" class="active" data-toggle="tab"> Contents </a>
                            </li>

                        </ul>
                    </div>
                    <div class="portlet-body">
                        <!--BEGIN TABS-->
                        <div class="tab-content">
                            <div class="tab-pane active" id="tab_1_1">
                                <div class="scroller" id="top-series" style="height: 340px;" data-always-visible="1" data-rail-visible="0">

                                </div>
                            </div>
                        </div>
                        <!--END TABS-->
                    </div>
                </div>
                <!-- END PORTLET-->
            </div>
            <div class="col-lg-8 col-md-12 col-xs-12 col-sm-12">
                <div class="portlet light bordered">
                    <div class="portlet-title">
                        <div class="caption ">
                            <span class="caption-subject font-dark bold uppercase">TRAFFİC</span>
                            <span class="caption-helper">distance    stats...</span>
                        </div>
                        <div class="actions">
                            <span class="time-information">
                                last 30 min
                            </span>
                            <a class="btn btn-circle btn-icon-only btn-default fullscreen" href="#"> </a>
                            <a class="btn btn-circle btn-icon-only btn-default" href="javascript:GetConcurrentCsvFile();">
                                <i class="icon-cloud-download"></i>
                            </a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="traffic" style="min-width: 310px; height: 350px; margin: 0 auto"></div>

                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4 col-md-12 col-xs-12 col-sm-12 padding-right-5">
                <!-- BEGIN WIDGET THUMB -->
                <div class="col-lg-12 col-md-4 col-sm-4 col-xs-12 widget-thumb widget-bg-color-white text-uppercase margin-bottom-20 bordered col-lg-12 col-md-4">
                    <h4 class="widget-thumb-heading">Mobile</h4>
                    <div class="widget-thumb-wrap">
                        <i class="widget-thumb-icon bg-green icon-screen-smartphone"></i>
                        <div class="widget-thumb-body">
                            <span class="widget-thumb-subtitle">User</span>
                            <span class="widget-thumb-body-stat" data-counter="counterup" data-value="7,644">0</span>
                        </div>
                    </div>
                </div>
                <!-- END WIDGET THUMB -->
                <div class="col-lg-12 col-md-4 col-sm-4 col-xs-12 widget-thumb widget-bg-color-white text-uppercase margin-bottom-20 bordered">
                    <h4 class="widget-thumb-heading">Computer</h4>
                    <div class="widget-thumb-wrap">
                        <i class="widget-thumb-icon bg-red icon-screen-desktop"></i>
                        <div class="widget-thumb-body">
                            <span class="widget-thumb-subtitle">User</span>
                            <span class="widget-thumb-body-stat" data-counter="counterup" data-value="1,293">0</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-12 col-md-4 col-sm-4 col-xs-12 widget-thumb widget-bg-color-white text-uppercase margin-bottom-20 bordered">
                    <h4 class="widget-thumb-heading">Tablet</h4>
                    <div class="widget-thumb-wrap">
                        <i class="widget-thumb-icon bg-purple icon-screen-tablet"></i>
                        <div class="widget-thumb-body">
                            <span class="widget-thumb-subtitle">User</span>
                            <span class="widget-thumb-body-stat" data-counter="counterup" data-value="815">0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-12 col-xs-12 col-sm-12">
                <!-- BEGIN REGIONAL STATS PORTLET-->
                <div class="portlet light bordered" style="padding-bottom:44px !important; ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="icon-share font-dark hide"></i>
                            <span class="caption-subject font-dark bold uppercase">Regional Stats</span>
                        </div>
                        <div class="actions">
                            <a class="btn btn-circle btn-icon-only btn-default fullscreen" data-container="false" data-placement="bottom" href="javascript:;">
                            </a>
                            <a class="btn btn-circle btn-icon-only btn-default" href="javascript:;">
                                <i class="icon-cloud-upload"></i>
                            </a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div id="region_statistics_loading">
                            <img src="~/Content/metronic_v4.7.5/assets/global/img/loading.gif" />
                        </div>
                        <div id="region_statistics_content" class="display-none">
                            <div class="btn-toolbar margin-bottom-10">
                                <a href="" class="btn grey-salsa btn-sm btn-circle"> Users </a>
                                <div class="btn-group pull-right">
                                    <a href="" class="btn btn-circle grey-salsa btn-sm dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                        Select Region
                                        <span class="fa fa-angle-down"> </span>
                                    </a>
                                    <ul class="dropdown-menu pull-right">
                                        <li>
                                            <a href="javascript:;" id="regional_stat_world"> World </a>
                                        </li>
                                        <li>
                                            <a href="javascript:;" id="regional_stat_usa"> USA </a>
                                        </li>
                                        <li>
                                            <a href="javascript:;" id="regional_stat_europe"> Europe </a>
                                        </li>
                                        <li>
                                            <a href="javascript:;" id="regional_stat_russia"> Russia </a>
                                        </li>
                                        <li>
                                            <a href="javascript:;" id="regional_stat_germany"> Germany </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div id="vmap_world" class="vmaps display-none"> </div>
                            <div id="vmap_usa" class="vmaps display-none"> </div>
                            <div id="vmap_europe" class="vmaps display-none"> </div>
                            <div id="vmap_russia" class="vmaps display-none"> </div>
                            <div id="vmap_germany" class="vmaps display-none"> </div>
                        </div>
                    </div>
                </div>
                <!-- END REGIONAL STATS PORTLET-->
            </div>


        </div>
    </div>
    <!-- END CONTENT BODY -->
</div>



@section scripts{
    
    <!-- BEGIN PAGE LEVEL PLUGINS -->

    <script src="/Content/metronic_v4.7.5/assets/global/plugins/moment.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js" type="text/javascript"></script>



    <script src="/Content/metronic_v4.7.5/assets/global/plugins/counterup/jquery.waypoints.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/counterup/jquery.counterup.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/horizontal-timeline/horizontal-timeline.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/flot/jquery.flot.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/flot/jquery.flot.resize.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/flot/jquery.flot.categories.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/jquery-easypiechart/jquery.easypiechart.min.js" type="text/javascript"></script>
    <script src="/Content/metronic_v4.7.5/assets/global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
    <!-- Map -->
    <script src="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/jquery.vmap.js" type="text/javascript"></script>
    <script src="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.russia.js" type="text/javascript"></script>
    <script src="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.world.js" type="text/javascript"></script>
    <script src="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.europe.js" type="text/javascript"></script>
    <script src="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.germany.js" type="text/javascript"></script>
    <script src="~/Content/metronic_v4.7.5/assets/global/plugins/jqvmap/jqvmap/maps/jquery.vmap.usa.js" type="text/javascript"></script>
    <script src="~/Scripts/CountryCodeConvert.js"></script>
    <script src="~/Content/metronic_v4.7.5/assets/global/scripts/app.min.js" type="text/javascript"></script>
    <!-- Highcharrts -->
    <script src="~/Content/metronic_v4.7.5/assets/pages/scripts/dashboard.js"></script>

    <script src="~/Scripts/TimeZoneConvertFunction.js"></script>
    
    <script src="~/Scripts/highcharts.js"></script>
    <script src="~/Scripts/exporting.js"></script>
    <script src="~/Scripts/Create.js"></script>
    <script type="text/javascript">

        var ConcurrentUser;
        var Traffic;
        var TotalSentBytesInTB;
        var res;
        var url = apiUrlCreate('CompanyId');
        var formData = FormDataRange('CompanyId');
        $.ajax({
            url: url,
            type: 'POST',
            data: formData,
            success: function (data) {
                $.each(data.Data, function (i, item) {
                    TotalSentBytesInTB = Math.floor(item.TotalSentBytesInTB);
                });
            },
            complete: function () {
                $('#TotalSentBytesInTB').attr("data-value", TotalSentBytesInTB);
                $('#TotalSentBytesInTB').text(TotalSentBytesInTB);
                $('#TotalSentBytesInTB').counterUp({
                    time: 1000,
                    delay: 30
                });
            },
            error: function (err) {
                console.log(err);
            }
        });

        //Concurrent User Chart Create
        formData = FormDataRange('user');
        $.ajax({
            url: 'http://api.serverstats.erstream.com/api/values/GetDashboardData',
            type: 'POST',
            data: formData,
            success: function (data) {
                createConUser('con-user', data);
                var dataLength = data.length - 1;
                ConcurrentUser = data[dataLength].cu;
            },
            complete: function () {
                $('#UserValue').attr("data-value", ConcurrentUser);
                $('#UserValue').text(ConcurrentUser);
                $('#UserValue').counterUp({
                    time: 1000,
                    delay: 30
                });
            },
            error: function (err) {
                console.log(err);
            }
        });

        //Traffic Chart Create
        formData = FormDataRange('traffic');

        $.ajax({
            url: 'http://api.serverstats.erstream.com/api/values/GetDashboardData',
            type: 'POST',
            data: formData,
            success: function (data) {
                createTraffic('traffic', data)
                var dataLength = data.length - 1;
                console.log();
                var tr =(data[dataLength].tv);
                    Traffic = ((tr).toFixed(3));
                res = Traffic.split(" ");
            },
            complete: function () {
                $('#TrafficValue').attr("data-value", res[0]);
                $('#TrafficValue').text("data-value", res[0]);
                $('#TrafficValue').counterUp({
                    time: 1000,
                    delay: 30
                });
            },
            error: function (err) {
                console.log(err);
            }
        });
        //Top 20 Series Section
        formData = FormDataRange('topSeries');
        $.ajax({
            url: 'http://api.serverstats.erstream.com/api/values/OneLevelGrid',
            type: 'POST',
            data: formData,
            success: function (data) {
                var totalWatching = 0;
                $.each(data, function (i, item) {
                    totalWatching = totalWatching + item.m_Item2;
                });
                var ul = $('<ul class="feeds">');
                var li = $('<li>');

                $.each(data, function (i, item) {
                    var ContentName = item.m_Item1;
                    var Views = item.m_Item2;
                    // Background Divi
                    var num = Math.floor((Views * 100) / totalWatching);
                    var n = num.toString();
                    // li oluşturma
                    var li = $('<li>');
                    var conts = $('<div class="con-ts width-color">');
                    conts.width(n + "%");
                    li.append(conts);
                    var col1 = $('<div class="col1">');
                    var col2 = $('<div class="col2">');
                    li.append(col1, col2);
                    //col1
                    var cont = $('<div class="cont">');
                    col1.append(cont);
                    var contcol2 = $('<div class="cont-col2">');
                    cont.append(contcol2);
                    var desc = $('<div class="desc">');
                    desc.append(ContentName);
                    contcol2.append(desc);
                    //col2
                    var date = $('<div class="date">');
                    col2.append(date);
                    date.append(Views);
                    ul.append(li);
                });

                $('#top-series').append(ul);
            },

            error: function (err) {
                console.log(err);
            }
        });

        var aggregate = 'TotalChunkCount-sum~TotalWatchingDurationInDay-sum~TotalSentBytesInTB-sum';
        var colors = [];
        //MAP
        FormData = DataTableFormData();
        url = apiUrlCreate('Country');
        $.ajax({
            url: url,
            type: 'POST',
            data: FormData,
            dataType: 'json',
            success: function (data) {
                $.each(data.Data, function (i, item) {
                    var cCode = (getCountryCode(item.Key)).toLowerCase();
                    sample_data["" + cCode + ""] = "" + item.TotalChunkCount + "";
                    var rgb = [];
                    for (var k = 0; k < 3; k++)
                        rgb.push(Math.floor(Math.random() * 255));
                    colors[i] = 'rgb(' + rgb.join(',') + ')';
                });
            },
            error: function (err) {
                console.log(err);
            }
        });

        var aggregate = 'TotalChunkCount-sum~TotalWatchingDurationInDay-sum~TotalSentBytesInTB-sum';
        var filter = "";
        var TableName = 'Country';
        var column = [];
        column.push(TableName, 'Total Sent By In TB', 'Total watching Duration', 'Total Chunk Out', 'Watching', 'Chunk Out');

        FormData = DataTableFormData(glfilterVal);
        url = apiUrlCreate(TableName);
        var sample_data = {};
        $.ajax({
            url: url,
            type: 'POST',
            data: FormData,
            dataType: 'json',
            success: function (data) {
                $.each(data.Data, function (i, item) {
                    var cCode = (getCountryCode(item.Key)).toLowerCase();
                    sample_data["" + cCode + ""] = "" + item.TotalChunkCount + "";
                });
            }
            ,
            complete: function () {
                function MapsVector() {
                    if (!jQuery().vectorMap) {
                        return;
                    }

                    var showMap = function (name) {
                        jQuery('.vmaps').hide();
                        jQuery('#vmap_' + name).show();
                    }

                    var setMap = function (name) {
                        var map = jQuery('#vmap_' + name);

                        if (map.size() !== 1) {
                            return;
                        }

                        var data = {
                            map: 'world_en',
                            backgroundColor: null,
                            borderColor: '#333333',
                            borderOpacity: 0.5,
                            borderWidth: 1,
                            color: '#c6c6c6',
                            enableZoom: true,
                            hoverColor: '#c9dfaf',
                            hoverOpacity: null,
                            values: sample_data,
                            normalizeFunction: 'linear',
                            scaleColors: ['#b6da93', '#909cae'],
                            selectedColor: '#c9dfaf',
                            selectedRegion: null,
                            showTooltip: true,
                            onLabelShow: function (event, label, code) {
                                if (sample_data[code] > 0)
                                    label.append(" : " + sample_data[code]);
                            },
                            onRegionOver: function (event, code) {
                                if (code == 'ca') {
                                    event.preventDefault();
                                }
                            }
                        };

                        data.map = name + '_en';

                        map.width(map.parent().parent().width());
                        map.show();
                        map.vectorMap(data);
                        map.hide();
                    }

                    setMap("world");
                    setMap("usa");
                    setMap("europe");
                    setMap("russia");
                    setMap("germany");
                    showMap("world");

                    jQuery('#regional_stat_world').click(function () {
                        showMap("world");
                    });

                    jQuery('#regional_stat_usa').click(function () {
                        showMap("usa");
                    });

                    jQuery('#regional_stat_europe').click(function () {
                        showMap("europe");
                    });
                    jQuery('#regional_stat_russia').click(function () {
                        showMap("russia");
                    });
                    jQuery('#regional_stat_germany').click(function () {
                        showMap("germany");
                    });

                    $('#region_statistics_loading').hide();
                    $('#region_statistics_content').show();

                    App.addResizeHandler(function () {
                        jQuery('.vmaps').each(function () {
                            var map = jQuery(this);
                            map.width(map.parent().width());
                        });
                    });
                }

                MapsVector();
            },
            error: function (err) {
                console.log(err);
            }
        });

    </script>
}

